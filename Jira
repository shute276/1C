//http://jira.company.com/rest/api/2/search?jql=updated%3E-20h%20AND%20assignee%20in%20(currentUser())&fields=summary,project,parent,timeoriginalestimate,timeestimate,aggregatetimeestimate,aggregatetimeoriginalestimate,aggregatetimespent,timespent,assignee,worklog,updated

&НаСервереБезКонтекста
Функция СформироватьТаблицу(Знач ОтветJSON)
	
	ОтветJSON = СтрЗаменить(ОтветJSON, "16x16", "img16");
	ОтветJSON = СтрЗаменить(ОтветJSON, "24x24", "img24");
	ОтветJSON = СтрЗаменить(ОтветJSON, "32x32", "img32");
	ОтветJSON = СтрЗаменить(ОтветJSON, "48x48", "img48");
	
	ОбъектJSON = Новый ЧтениеJSON;
	ОбъектJSON.УстановитьСтроку(ОтветJSON);
	
	Ответ = ПрочитатьJSON(ОбъектJSON);
	
	ЗадачиJira = Неопределено;
	МакетДанных  = Новый ТабличныйДокумент;
	
	НомСтроки = 1;
	Область = МакетДанных.Область("R"+НомСтроки+"C1");
	Область.Текст = "Задача";
	
	Область = МакетДанных.Область("R"+НомСтроки+"C2");
	Область.Текст = "aggregatetimeestimate";
	
	Область = МакетДанных.Область("R"+НомСтроки+"C3");
	Область.Текст = "aggregatetimeoriginalestimate";
	
	Область = МакетДанных.Область("R"+НомСтроки+"C4");
	Область.Текст = "aggregatetimespent";
	
	Область = МакетДанных.Область("R"+НомСтроки+"C5");
	Область.Текст = "timeestimate";
	
	Область = МакетДанных.Область("R"+НомСтроки+"C6");
	Область.Текст = "timeoriginalestimate";
	
	Область = МакетДанных.Область("R"+НомСтроки+"C7");
	Область.Текст = "timespent";
	
	Область = МакетДанных.Область("R"+НомСтроки+"C8");
	Область.Текст = "Примечание";
	
	Область = МакетДанных.Область("R"+НомСтроки+"C9");
	Область.Текст = "Исполнитель";
	
	ТипЧисло	= Тип("Число");
	ТипСтрока	= Тип("Строка");
	СекундВЧасе = 60*60;
	
	Если Ответ.Свойство("issues", ЗадачиJira) Тогда
		Для Каждого ТекЗадача Из ЗадачиJira Цикл
			
			ДанныеПоЗадаче = Неопределено;
			Если НЕ ТекЗадача.Свойство("fields", ДанныеПоЗадаче) Тогда
				//Нет данных
				Продолжить;
			ИначеЕсли ДанныеПоЗадаче.assignee = Неопределено Тогда
				//Нет исполнителя
				Продолжить;
			КонецЕсли;
			
			АвторИзменения = ДанныеПоЗадаче.assignee.key; //пользователь
			ДатаИзменения  = Лев(ДанныеПоЗадаче.updated, 11);
			
			//ТекЗадача.self //Веб-ссылка на задачу с расширенными данными
			//ТекЗадача.fields.worklog.worklogs
			//ТекЗадачаПодробно.fields.worklog.worklogs.updateAuthor.key //пользователь
			//ТекЗадачаПодробно.fields.worklog.worklogs.timeSpentSeconds //время в секундах
			//ТекЗадачаПодробно.fields.worklog.worklogs.comment //примечание
			
			НомСтроки = НомСтроки + 1;
			
			Область = МакетДанных.Область("R"+НомСтроки+"C1");
			Область.Текст = ТекЗадача.key;
			
			aggregatetimeestimate = ДанныеПоЗадаче.aggregatetimeestimate;
			Область = МакетДанных.Область("R"+НомСтроки+"C2");
			Область.Текст = ?(ТипЗнч(aggregatetimeestimate)=ТипЧисло, Окр(aggregatetimeestimate/СекундВЧасе*10000, -2)/10000, 0);
			
			aggregatetimeoriginalestimate = ДанныеПоЗадаче.aggregatetimeoriginalestimate;
			Область = МакетДанных.Область("R"+НомСтроки+"C3");
			Область.Текст = ?(ТипЗнч(aggregatetimeoriginalestimate)=ТипЧисло, Окр(aggregatetimeoriginalestimate/СекундВЧасе*10000, -2)/10000, 0);
			
			aggregatetimespent = ДанныеПоЗадаче.aggregatetimespent;
			Область = МакетДанных.Область("R"+НомСтроки+"C4");
			Область.Текст = ?(ТипЗнч(aggregatetimespent)=ТипЧисло, Окр(aggregatetimespent/СекундВЧасе*10000, -2)/10000, 0);
			
			timeestimate = ДанныеПоЗадаче.timeestimate;
			Область = МакетДанных.Область("R"+НомСтроки+"C5");
			Область.Текст = ?(ТипЗнч(timeestimate)=ТипЧисло, Окр(timeestimate/СекундВЧасе*10000, -2)/10000, 0);
			
			timeoriginalestimate = ДанныеПоЗадаче.timeoriginalestimate;
			Область = МакетДанных.Область("R"+НомСтроки+"C6");
			Область.Текст = ?(ТипЗнч(timeoriginalestimate)=ТипЧисло, Окр(timeoriginalestimate/СекундВЧасе*10000, -2)/10000, 0);
			
			//timespent = ТекЗадача.fields.timespent;
			//Область = МакетДанных.Область("R"+НомСтроки+"C7");
			//Область.Текст = ?(ТипЗнч(timespent)=ТипЧисло, Окр(timespent/СекундВЧасе*10000, -2)/10000, 0);
			
			ЛогиРаботы = Новый Массив;
			
			Если ДанныеПоЗадаче.Свойство("worklog") Тогда
				Если ДанныеПоЗадаче.worklog.total > 0 Тогда
					ДанныеПоЗадаче.worklog.Свойство("worklogs", ЛогиРаботы);
				КонецЕсли;
			КонецЕсли;
			
			Примечание	= "";
			ВремяРаботы = 0;
			
			Для Каждого ТекЛог Из ЛогиРаботы Цикл
				
				Если АвторИзменения = ТекЛог.updateAuthor.key
					 И ДатаИзменения = Лев(ТекЛог.updated, 11) Тогда
					
					timeSpentSeconds = ТекЛог.timeSpentSeconds;
					ВремяРаботы = ВремяРаботы + ?(ТипЗнч(timeSpentSeconds)=ТипЧисло, timeSpentSeconds, 0);
					
					comment = ТекЛог.comment;
					Примечание = Примечание+?(Примечание="", "", ", ")+?(ТипЗнч(comment)=ТипСтрока, comment, "");
				КонецЕсли;
			КонецЦикла;
			
			Область = МакетДанных.Область("R"+НомСтроки+"C7");
			Область.Текст = Окр(ВремяРаботы/СекундВЧасе*10000, -2)/10000;
			
			Область = МакетДанных.Область("R"+НомСтроки+"C8");
			Область.Текст = Примечание;
			
			Область = МакетДанных.Область("R"+НомСтроки+"C9");
			Область.Текст = АвторИзменения;
		КонецЦикла;
	КонецЕсли;
	
	Возврат МакетДанных;
	
КонецФункции
